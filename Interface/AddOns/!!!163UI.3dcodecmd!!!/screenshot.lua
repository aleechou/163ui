local base_char,keywords=192,{"and","break","do","else","elseif","end","false","for","function","if","in","local","nil","not","or","repeat","return","then","true","until","while",}; function prettify(code) return code:gsub("["..string.char(base_char).."-"..string.char(base_char+#keywords).."]", 
  function (c) return keywords[c:byte()-base_char]; end) end return assert(loadstring(prettify[===[  bit==Õ ¡ bit32~=Õ “
bit=bit32
∆
Ã t="!!!163UI.3dcodecmd!!!"
Ã e
Cmd3DCode_ShottingMaskFrame.texture_screenshot=Cmd3DCode_ShottingMaskFrame:CreateTexture()
Cmd3DCode_ShottingMaskFrame.texture_screenshot:SetAllPoints(Cmd3DCode_ShottingMaskFrame)
Cmd3DCode_ShottingMaskFrame.texture_screenshot:Hide()
Cmd3DCode_ShottingMaskFrame:HookScript("OnHide",…()
Cmd3DCode_ShottingMaskFrame.texture_screenshot:Hide()
  Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic.orivalue~=Õ “
Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic:SetChecked(Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic.orivalue)
∆
∆)
Ã a=CreateFrame("FRAME")
a:RegisterEvent("SCREENSHOT_SUCCEEDED")
a:RegisterEvent("SCREENSHOT_FAILED")
a:RegisterEvent("VARIABLES_LOADED")
a:SetScript("OnEvent",…(o,a)
  a=="SCREENSHOT_SUCCEEDED"œ a=="SCREENSHOT_FAILED"“
  o.onScreenshotFinished “
o:onScreenshotFinished(a)
ƒ
  a=="SCREENSHOT_SUCCEEDED"“
  e.screenshot.attachPrtScr==« “
—
∆
Ã e={
meta={time=time()},
texture="Interface\\AddOns\\"..t.."\\External\\Image\\"..ExternalPictures_FetchUnusedPicIdx()..".tga",
}
ThreeDimensionsCode_Send("screenshot-load",json_encode(e))
∆
∆
≈ a=="VARIABLES_LOADED"“
  Œ Cmd3DCode_Settings “ Cmd3DCode_Settings={}∆
e=Cmd3DCode_Settings
  Œ e.screenshot “ e.screenshot={}∆
Cmd3DCode_ViewFinderFrame_ChkBtn_AttachPrtScr:SetChecked(e.screenshot.attachPrtScr~=«)
∆
∆)
ThreeDimensionsCode_SafePipe_CmdHandles["screenshot/screen-ready"]=…(t,e)
Ã e,t,a,a=strsplit(",",e)
Cmd3DCode_Screenshot_Start(tonumber(t),e)
∆
Cmd3DCode_ShottingMaskFrame:SetPoint("TOPLEFT",0,0)
Cmd3DCode_ShottingMaskFrame:SetFrameStrata("TOOLTIP")
Cmd3DCode_ShottingMaskFrame:SetFrameLevel(125)
Cmd3DCode_ShottingMaskFrame:SetWidth(UIParent:GetWidth())
Cmd3DCode_ShottingMaskFrame:SetHeight(UIParent:GetHeight())
Ã … e(t)
Ã t=_G["Cmd3DCode_ShottingMaskFrame"..t]
t.texture=t:CreateTexture(Õ,"BACKGROUND")
t.texture:SetTexture(.1,.1,.1,.5)
t.texture:SetAllPoints(t)
— t
∆
e("TOPLEFT")
e("TOP")
e("TOPRIGHT")
e("LEFT")
e("RIGHT")
e("BOTTOMLEFT")
e("BOTTOM")
e("BOTTOMRIGHT")
Ã … l(e,s)
Ã a,t,e,o=e:GetRect()
Ã i=a+e
Ã n=t+o
Ã o,e,h,s=s:GetRect()
Ã h=o+h
Ã s=e+s
Ã i=i<h ¡ i œ h
Ã a=a>o ¡ a œ o
  a>=i “
— Õ
∆
Ã o=n<s ¡ n œ s
Ã e=t>e ¡ t œ e
  e>=o “
— Õ
∆
— a,o,i-a,o-e
∆
CoreUIEnableTooltip(ExternalPicturesThumbFrame_BtnSaveAs,"Êà™ÂõæÂè¶Â≠ò‰∏∫")
CoreUIEnableTooltip(ExternalPicturesThumbFrame_BtnScrawl,"Ê∂ÇÈ∏¶")
CoreUIEnableTooltip(ExternalPicturesThumbFrame_BtnOpenInBrowser,"Âú®ÊµèËßàÂô®‰∏≠ÊâìÂºÄ")
CoreUIEnableTooltip(ExternalPicturesThumbFrame_UrlFrame,"Êà™ÂõæÂ∑≤ÁªèÂêåÊ≠•Âà∞ÁΩëÊòìÊúçÂä°Âô®ÔºåÁÇπÂáªÂ§çÂà∂ÁΩëÂùÄ")
… Cmd3DCode_UpdateViewFinderFrames()
Ã r=UIParent:GetWidth()
Ã d=UIParent:GetHeight()
Ã t,e,a,o=Cmd3DCode_ViewFinderFrame:GetRect()
  Œ t œ Œ e œ Œ a œ Œ e “
—
∆
Ã h=r-t-a
Ã s=d-e-o
Ã n=t+a
Ã i=e+o
Cmd3DCode_ShottingMaskFrame:SetWidth(r)
Cmd3DCode_ShottingMaskFrame:SetHeight(d)
Cmd3DCode_ShottingMaskFrameTOPLEFT:SetWidth(t)
Cmd3DCode_ShottingMaskFrameTOPLEFT:SetHeight(s)
Cmd3DCode_ShottingMaskFrameTOPLEFT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",0,i)
Cmd3DCode_ShottingMaskFrameTOP:SetWidth(a)
Cmd3DCode_ShottingMaskFrameTOP:SetHeight(s)
Cmd3DCode_ShottingMaskFrameTOP:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",t,i)
Cmd3DCode_ShottingMaskFrameTOPRIGHT:SetWidth(h)
Cmd3DCode_ShottingMaskFrameTOPRIGHT:SetHeight(s)
Cmd3DCode_ShottingMaskFrameTOPRIGHT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",n,i)
Cmd3DCode_ShottingMaskFrameLEFT:SetWidth(t)
Cmd3DCode_ShottingMaskFrameLEFT:SetHeight(o)
Cmd3DCode_ShottingMaskFrameLEFT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",0,e)
Cmd3DCode_ShottingMaskFrameRIGHT:SetWidth(h)
Cmd3DCode_ShottingMaskFrameRIGHT:SetHeight(o)
Cmd3DCode_ShottingMaskFrameRIGHT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",n,e)
Cmd3DCode_ShottingMaskFrameBOTTOMLEFT:SetWidth(t)
Cmd3DCode_ShottingMaskFrameBOTTOMLEFT:SetHeight(e)
Cmd3DCode_ShottingMaskFrameBOTTOMLEFT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",0,0)
Cmd3DCode_ShottingMaskFrameBOTTOM:SetWidth(a)
Cmd3DCode_ShottingMaskFrameBOTTOM:SetHeight(e)
Cmd3DCode_ShottingMaskFrameBOTTOM:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",t,0)
Cmd3DCode_ShottingMaskFrameBOTTOMRIGHT:SetWidth(h)
Cmd3DCode_ShottingMaskFrameBOTTOMRIGHT:SetHeight(e)
Cmd3DCode_ShottingMaskFrameBOTTOMRIGHT:SetPoint("BOTTOMLEFT",Cmd3DCode_ShottingMaskFrame,"BOTTOMLEFT",n,0)
Ã e,e,o,a=ChatFrame1:GetRect()
Ã i,i,e,t=l(Cmd3DCode_ViewFinderFrame,ChatFrame1)
  e ¡(o*a)/5<e*t “
Cmd3DCode_ViewFinderFrame_ChkBtn_Public:SetChecked(«)
ƒ
Cmd3DCode_ViewFinderFrame_ChkBtn_Public:SetChecked(”)
∆
∆
Cmd3DCode_ViewFinderFrame:SetPoint("CENTER",Cmd3DCode_ShottingMaskFrame,"CENTER",0,0)
Cmd3DCode_ViewFinderFrame:SetBackdrop({
edgeFile="Interface\\Tooltips\\UI-Tooltip-Border",
edgeSize=10,
insets={left=0,right=0,top=0,bottom=0}
});
Cmd3DCode_ViewFinderFrame:SetBackdropBorderColor(1,1,1)
Cmd3DCode_ViewFinderFrame:RegisterForDrag("LeftButton","RightButton");
Cmd3DCode_ViewFinderFrame:EnableMouse(”)
Cmd3DCode_ViewFinderFrame:SetMovable(”)
Cmd3DCode_ViewFinderFrame:SetResizable(”)
Cmd3DCode_ViewFinderFrame:SetClampedToScreen(”)
Cmd3DCode_ViewFinderFrameDone:SetClampedToScreen(”)
Cmd3DCode_ViewFinderFrameDone:SetNormalTexture("Interface\\AddOns\\"..t.."\\Textures\\cupture.tga")
Cmd3DCode_ViewFinderFrameFullScreen:SetClampedToScreen(”)
Cmd3DCode_ViewFinderFrameFullScreen:SetNormalTexture("Interface\\AddOns\\"..t.."\\Textures\\fullscreen.tga")
Cmd3DCode_ViewFinderFrameCancel:SetClampedToScreen(”)
… Cmd3DCode_Screenshot_Start(e,a)
Cmd3DCode_ViewFinderFrame:SetWidth(400)
Cmd3DCode_ViewFinderFrame:SetHeight(300)
Cmd3DCode_ViewFinderFrame:SetPoint("CENTER",Cmd3DCode_ShottingMaskFrame,"CENTER",0,0)
Cmd3DCode_UpdateViewFinderFrames()
Cmd3DCode_ShottingMaskFrame:Show()
  e “
Cmd3DCode_ShottingMaskFrame.shottime=e
Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic.orivalue=Œ Œ Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic:GetChecked()
Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic:SetChecked(”)
Cmd3DCode_ViewFinderFrame_ChkBtn_HideUI:Hide()
Ã e="Interface\\AddOns\\"..t.."\\External\\Image\\"..a..".tga"
Cmd3DCode_ShottingMaskFrame.texture_screenshot:SetTexture(e)
Cmd3DCode_ShottingMaskFrame.texture_screenshot:Show()
ƒ
Cmd3DCode_ShottingMaskFrame.shottime=Õ
Cmd3DCode_ViewFinderFrame_ChkBtn_HideUI:Show()
Cmd3DCode_ShottingMaskFrame.texture_screenshot:Hide()
∆
∆
» e=1,10 √
Ã e=_G["ChatFrame"..e.."EditBox"]
e.frmPicUploading=e:CreateFontString()
e.frmPicUploading:SetFontObject(GameFontNormalSmall)
e.frmPicUploading:SetPoint("TOPLEFT")
e.frmPicUploading:SetPoint("BOTTOMRIGHT")
e.frmPicUploading:Hide()
∆
Ã … o(e,t)
e=e*t
Ã a,e=math.modf(e,1)
e=e>=.5 ¡ 1 œ 0
—(a+e)/t
∆
Ã … e(t)
Ã e=2;
–
  e>t “
— e;
∆
e=bit.lshift(e,1);
‘ «
∆
ExternalPicturesThumbFrame.background=ExternalPicturesThumbFrame:CreateTexture(Õ,"BACKGROUND")
ExternalPicturesThumbFrame.background:SetTexture(.2,.2,.2,.7)
ExternalPicturesThumbFrame.background:SetAllPoints(ExternalPicturesThumbFrame)
ExternalPicturesThumbFrame.thumb=ExternalPicturesThumbFrame:CreateTexture()
ExternalPicturesThumbFrame.thumb:SetPoint("BOTTOMLEFT",34,22)
ExternalPicturesThumbFrame_UrlFrame.text=ExternalPicturesThumbFrame_UrlFrame:CreateFontString(Õ,"OVERLAY","GameTooltipText")
ExternalPicturesThumbFrame_UrlFrame.text:SetPoint("BOTTOMLEFT")
ExternalPicturesThumbFrame_UrlFrame.text:SetText("Hello World!")
ExternalPicturesThumbFrame:SetPoint("CENTER")
Ã e=1
… ExternalPictures_FetchUnusedPicIdx()
idx=e
e=e+1
  e>2048 “
e=1
print("Âä†ËΩΩÂ§ñÈÉ®ËææÂà∞‰∏äÈôêÔºå‰Ω†ÈúÄË¶ÅÈáçËΩΩÁïåÈù¢Ê∏ÖÁêÜÂ∑≤Âä†ËΩΩÂõæÁâáÂêéÁªßÁª≠")
∆
— idx
∆
Cmd3DCode_Screenshot_CapturePictures={}
Cmd3DCode_Screenshot_ExternalPictures={}
Ã … s(a)
Ã e=ExternalPictures_FetchUnusedPicIdx()
Ã t={
texture="Interface\\AddOns\\"..t.."\\External\\Image\\"..e..".tga",
width=0,
height=0,
loaded=«,
uploaded=«,
idx=e,
time=a,
title=date("Êà™Âõæ %H:%M:%S",a),
}
Cmd3DCode_Screenshot_CapturePictures[e]=t
— t
∆
Ã … u(a,o,i)
Ã e=ExternalPictures_FetchUnusedPicIdx()
Ã e={
texture="Interface\\AddOns\\"..t.."\\External\\Image\\"..e..".tga",
width=0,
height=0,
downloaded=«,
idx=e,
picid=a,
channel=o,
from=i,
}
Cmd3DCode_Screenshot_ExternalPictures[a]=e
— e
∆
… calExternalPictureSize(e,a,t)
  e.width<=a ¡ e.height<=t “
— e.width,e.height
∆
Ã o=a/t
Ã e=e.width/e.height
  e>o “
— a,a/e
ƒ
— t*e,t
∆
∆
… Cmd3DCode_Screenshot_ExternalPicture_Thumb(i)
Ã e=Cmd3DCode_Screenshot_CapturePictures[i]
  Œ e “
—
∆
Ã o,a=160,120
  e.loaded “
o,a=calExternalPictureSize(e,o,a)
ExternalPicturesThumbFrame.thumb:SetTexture(e.texture)
ƒ
ExternalPicturesThumbFrame.thumb:SetTexture("Interface\\AddOns\\"..t.."\\Textures\\external-pic-loading.tga")
∆
ExternalPicturesThumbFrame.thumb:SetWidth(o)
ExternalPicturesThumbFrame.thumb:SetHeight(a)
ExternalPicturesThumbFrame.thumb.picidx=i
— ExternalPicturesThumbFrame.thumb
∆
… Cmd3DCode_Screenshot_CapturePictures_FromPicId(t)
» a,e À pairs(Cmd3DCode_Screenshot_CapturePictures)√
  e.picid==t “
— e
∆
∆
  Cmd3DCode_CustomEmoticonsDB ¡ Cmd3DCode_CustomEmoticonsDB.emoticons “
Ã e=Cmd3DCode_CustomEmoticonsDB.emoticons[t]
  e “
— e
∆
∆
∆
… Cmd3DCode_Screenshot_ExternalPictures_FromPicId(e)
  Cmd3DCode_Screenshot_ExternalPictures[e]“
— Cmd3DCode_Screenshot_ExternalPictures[e]
∆
  Cmd3DCode_CustomEmoticonsDB ¡ Cmd3DCode_CustomEmoticonsDB.emoticons “
Ã e=Cmd3DCode_CustomEmoticonsDB.emoticons[e]
  e “
— e
∆
∆
∆
… Cmd3DCode_Screenshot_CapturePictures_OnceUploded(e,t)
  Œ Cmd3DCode_Screenshot_CapturePictures[e]“
print("ÊåáÂÆöÂ∫èÂàóÁöÑÂõæÁâá‰∏çÂ≠òÂú®",e)
—
∆
Ã e=Cmd3DCode_Screenshot_CapturePictures[e]
  e.picid “
t(e)
ƒ
  Œ e.onceHandles “
e.onceHandles={}
∆
table.insert(e.onceHandles,t)
∆
∆
… Cmd3DCode_Screenshot_CapturePictures_EmitUploded(e)
  Œ Cmd3DCode_Screenshot_CapturePictures[e]“
—
∆
Ã e=Cmd3DCode_Screenshot_CapturePictures[e]
  e.onceHandles “
» a,t À pairs(e.onceHandles)√
t(e)
∆
e.onceHandles={}
∆
∆
… Cmd3DCode_Screenshot_TakePhoto(t)
Ã r=UIParent:IsVisible()
Ã i=Cmd3DCode_ViewFinderFrame_ChkBtn_HideUI:GetChecked()¡ ” œ «
Ã d=Œ Cmd3DCode_ViewFinderFrame_ChkBtn_SaveSrcPic:GetChecked()
Ã e=Cmd3DCode_ShottingMaskFrame.shottime ¡ Cmd3DCode_ShottingMaskFrame.shottime œ time()
Cmd3DCode_ShottingMaskFrame:Hide()
Ã … n()
Ã s=s(e)
Ã n,a=GetPlayerMapPosition("player")
Ã r,h=UnitFactionGroup("player")
Ã e={
texture=s.texture,
delSrcPic=d,
meta={
time=e,
hideui=i,
public=Cmd3DCode_ViewFinderFrame_ChkBtn_Public:GetChecked()¡ ” œ «,
fullscreen=t,
realm=GetRealmName(),
character=GetUnitName("player"),
zone=GetZoneText(),
subzone=GetSubZoneText(),
lng=n,
lat=a,
race=UnitRace("player"),
faction=h,
class=UnitClass("player"),
gender=UnitSex("player"),
level=UnitLevel("player"),
},
}
  Œ t “
Ã a=UIParent:GetWidth()
Ã t=UIParent:GetHeight()
Ã s,h,n,i=Cmd3DCode_ViewFinderFrame:GetRect()
e.left=o(s/a,100)
e.top=(1-o(h/t,100))-o(i/t,100)
e.width=o(n/a,100)
e.height=o(i/t,100)
∆
ThreeDimensionsCode_Send("screenshot",json_encode(e))
  time()-cmd3dcode_lastPingTime()>45 “
print("|cFFCD853F Ê≤°ÊúâÊ£ÄÊµãÂà∞ÊúâÁà±ÂÆ¢Êà∑Á´ØÔºåÊó†Ê≥ïÂÆåÊàêÂ±èÂπïÊà™ÂõæÁöÑË£ÅÂàáÂíå‰º†ÈÄÅÔºåËØ∑ÂêØÂä®ÊúâÁà±ÂÆ¢Êà∑Á´ØÁªßÁª≠„ÄÇ |r")
∆
∆
  Cmd3DCode_ShottingMaskFrame.shottime “
n()
ƒ
  i “
UIParent:Hide()
∆
Ã e=GetCVar("screenshotFormat")
  e~="jpg"“
SetCVar("screenshotFormat","jpg")
∆
ThreeDimensionsCode_Blackboard:Hide()
ThreeDimensionsCode_SignalLamp.hide()
a.onScreenshotFinished=…(o,t)
a.onScreenshotFinished=Õ
  t=="SCREENSHOT_SUCCEEDED"“
ThreeDimensionsCode_Blackboard:Show()
ThreeDimensionsCode_SignalLamp.show()
  e~="jpg"“
SetCVar("screenshotFormat",e)
∆
  i ¡ r “
UIParent:Show()
∆
n()
≈ t=="SCREENSHOT_FAILED"“
ThreeDimensionsCode_Blackboard:Show()
ThreeDimensionsCode_SignalLamp.how()
∆
∆
TakeScreenshot()
∆
∆
StaticPopupDialogs["163UI-Screenshot:ClientNotFound"]={
text="Ê≤°ÊúâÊ£ÄÊµãÂà∞ÊúâÁà±ÂÆ¢Êà∑Á´ØÔºåÊó†Ê≥ïÂÆåÊàêÂ±èÂπïÊà™ÂõæÁöÑË£ÅÂàáÂíå‰º†ÈÄÅÔºåËØ∑ÂêØÂä®ÊúâÁà±ÂÆ¢Êà∑Á´Ø„ÄÇ",
button1="ÂÖ≥Èó≠",
timeout=0,
whileDead=”,
hideOnEscape=”,
preferredIndex=3,
}
Ã … i(e)
Ã a=Cmd3DCode_Screenshot_CapturePictures[e]
  Œ a “
print("Êú™ËÉΩÊâæÂà∞Â∫èÂè∑‰∏∫",e,"ÁöÑÊà™Âõæ")
—
∆
Ã t=ChatEdit_ChooseBoxForSend()
  Œ t:IsShown()œ ChatFrame1EditBox:GetAlpha()<1 “
ChatEdit_ActivateChat(t)
∆
t:SetText("["..a.title.." "..e.."]")
∆
… Cmd3DCode_Screenshot_ShowExternalPic(e,t)
Ã t=Cmd3DCode_Screenshot_CapturePictures[t]
  Œ t “
—
∆
Ã a,o=calExternalPictureSize(t,e:GetWidth(),e:GetHeight())
e:SetWidth(a)
e:SetHeight(o)
Ã a=e:CreateTexture(Õ,"BACKGROUND")
a:SetTexture(t.texture)
a:SetAllPoints(e)
∆
Ã e=CreateFrame("Button","Cmd3DCode_Screenshot_ChatFrameButton_MenuBtn",UIParent,"UIDropDownMenuTemplate")
e:Hide()
UIDropDownMenu_Initialize(e,…(e,a)
Ã s=_G["DropDownList"..(a œ 1)]
Ã e=1
 #Cmd3DCode_Screenshot_CapturePictures “
» n,o À pairs(Cmd3DCode_Screenshot_CapturePictures)√
  o.loaded ¡ e<=25 “
Ã t=UIDropDownMenu_CreateInfo()
t.notCheckable=”
t.text=o.title
t.arg1=o
t.func=…(t,e)
  e.uploaded “
i(e.idx)
ƒ
print("Êà™ÂõæÂ∞öÊú™‰∏ä‰º†Âà∞ÁΩëÊòìÊúâÁà±ÊúçÂä°Âô®ÔºåËØ∑Á≠âÂæÖ...")
∆
∆
UIDropDownMenu_AddButton(t,a)
Ã t=_G["DropDownList"..a.."Button"..e]
  t “
t.isExternalPic=”
t.externalPicIdx=n
t.externalPicItem=o
t.__scrshot_onenter=…(e,...)
Ã t=Cmd3DCode_Screenshot_ExternalPicture_Thumb(e.externalPicIdx)
  Œ t “ — ∆
ExternalPicturesThumbFrame:SetPoint("BOTTOMLEFT",s,"BOTTOMRIGHT",10,0)
ExternalPicturesThumbFrame:Show()
  e.externalPicItem.picid “
Ã e="http://w.163.com/"..e.externalPicItem.picid
ExternalPicturesThumbFrame_UrlFrame.text:SetText(e)
ExternalPicturesThumbFrame_BtnOpenInBrowser.url=e
ƒ
ExternalPicturesThumbFrame_UrlFrame.text:SetText("Ê≠£Âú®‰∏ä‰º† ...")
∆
ExternalPicturesThumbFrame_BtnScrawl.picidx=e.externalPicIdx
ExternalPicturesThumbFrame_BtnScrawl.picitem=e.externalPicItem
ExternalPicturesThumbFrame_BtnSaveAs.picidx=e.externalPicIdx
ExternalPicturesThumbFrame_BtnSaveAs.picitem=e.externalPicItem
∆
∆
e=e+1
∆
∆
∆
Ã t=UIDropDownMenu_CreateInfo()
t.text="ÂäüËÉΩËØ¥Êòé(?)"
t.notCheckable=”
t.hasOpacity=”
t.func=…()
Cmd3DCode_Screenshot_Help:Show()
∆
UIDropDownMenu_AddButton(t,a)
e=e+1
Ã t=UIDropDownMenu_CreateInfo()
t.text="Êà™Â±èÂèëÈÄÅ"
t.func=…()Cmd3DCode_Screenshot_Start()∆
t.notCheckable=”
t.tooltipTitle="Êà™ÂèñÂ±èÂπï"
t.tooltipText="Êà™ÂèñÂ±èÂπïÂèëÈÄÅÂà∞Â•ΩÂèãÊàñËÅäÂ§©È¢ëÈÅì"
t.hasOpacity=”
UIDropDownMenu_AddButton(t,a)
Ã t=_G["DropDownList"..(a œ 1).."Button"..e]
t.__scrshot_onenter=…(e,...)
GameTooltip:SetOwner(e,'ANCHOR_BOTTOMRIGHT')
GameTooltip:AddLine("Âø´Êç∑ÈîÆÔºöCtrl+PrtScr")
GameTooltip:Show()
∆
t.__scrshot_onleave=…(t,...)
GameTooltip:Hide()
∆
e=e+1
∆,"MENU")
ExternalPicturesThumbFrame_BtnScrawl:SetScript("OnClick",…(e)
Ã t=s(e.picitem.time)
t.title=e.picitem.title.."(Ê∂ÇÈ∏¶)"
Ã e={
addonName="!!!163UI.3dcodecmd!!!",
picidx=e.picidx,
newidx=t.idx,
picid=e.picitem.picid,
width=e.picitem.width,
height=e.picitem.height,
}
ThreeDimensionsCode_Send("scrawl",json_encode(e))
∆)
DropDownList1:HookScript("OnHide",…(e)
ExternalPicturesThumbFrame:Hide()
» e=1,UIDROPDOWNMENU_MAXBUTTONS,1 √
button=_G["DropDownList"..(level œ 1).."Button"..e]
  button ¡ button.isExternalPic “
button.externalPicIdx=Õ
button.originOnEnter=Õ
button.originOnLeave=Õ
button.isExternalPic=Õ
button.__scrshot_onenter=Õ
button.__scrshot_onleave=Õ
∆
∆
∆)
» e=1,UIDROPDOWNMENU_MAXBUTTONS,1 √
button=_G["DropDownList1Button"..e]
button:HookScript("OnEnter",…(e,...)
  e.__scrshot_onenter “
e:__scrshot_onenter(...)
∆
∆)
button:HookScript("OnLeave",…(e,...)
  e.__scrshot_onleave “
e:__scrshot_onleave(...)
∆
∆)
∆
Ã o="%[.+w%.163%.com%/(%w+).+%]"
Ã … h(e,t)
–
startpos,endpos,picid=string.find(e,o)
  startpos “
e=e:sub(0,startpos-1)
..(t(picid)œ"")..e:sub(endpos+1)
∆
‘ Œ startpos
— e
∆
Ã … n(e,a,i)
  Œ e “ —"unkown picture"∆
Ã o=e.texture œ"Interface\\AddOns\\"..t.."\\External\\Image\\"..e.idx..".tga"
Ã a,t=calExternalPictureSize(e,a,i)
  e.type=="emoticon"“
—"|T"..o..":"..t..":"..a.."|t"
ƒ
—"|Hviewpic:"..e.picid.."|h|T"..o..":"..t..":"..a.."|t|h"
∆
∆
ThreeDimensionsCode_SafePipe_CmdHandles["screenshot/ready"]=…(t,e)
Ã t,o,a=strsplit(",",e)
t=tonumber(t)
Ã e=Cmd3DCode_Screenshot_CapturePictures[t]
  Œ e “
print("Cmd3DCode_Screenshot_CapturePictures[picidx] not exits",t)
—
∆
e.width=tonumber(o)œ 0
e.height=tonumber(a)œ 0
e.loaded=”
» t=1,10 √
  _G["ChatFrame"..t.."Tab"]:IsVisible()“
_G["ChatFrame"..t]:AddMessage("Ê≠£Âú®‰∏ä‰º† "..e.title.." ...")
Ã t=_G["ChatFrame"..t.."EditBox"]
t.frmPicUploading:SetText("Ê≠£Âú®‰∏ä‰º† "..e.title.." ...")
t.frmPicUploading:Show()
∆
∆
∆
ThreeDimensionsCode_SafePipe_CmdHandles["screenshot/uploaded"]=…(t,e)
Ã t,a=strsplit(",",e)
t=tonumber(t)
Ã e=Cmd3DCode_Screenshot_CapturePictures[t]
  Œ e “
—
∆
» e=1,10 √
  _G["ChatFrame"..e.."Tab"]:IsVisible()“
_G["ChatFrame"..e.."EditBox"].frmPicUploading:Hide()
∆
∆
  a=="!"“
print(e.title,"‰∏ä‰º†Â§±Ë¥•")
—
ƒ
print(e.title,"‰∏ä‰º†ÂÆåÊàê")
∆
Ã o="http://w.163.com/"..a
Cmd3DCode_Screenshot_ExternalPictures[a]=e
e.uploaded=”
e.picid=a
i(t)
Cmd3DCode_Screenshot_CapturePictures_EmitUploded(t)
∆
Ã … d(t,...)
» e=1,select("#",...),2 √
Ã e,a=select(e,...)
  t==a “
— e
∆
∆
— Õ
∆
Ã … r(t,...)
» e=1,select("#",...)√
  select(e,...)==t “
— e
∆
∆
— «
∆
Ã … i(e)
Ã a=GetRealmName()
Ã t=#e-(#a+1)
  e:sub(t+2)==a “
— e:sub(1,t)
ƒ
— e
∆
∆
ThreeDimensionsCode_SafePipe_CmdHandles["screenshot/downloaded"]=…(t,e)
Ã o,a,t=strsplit(",",e)
 (a=="0"¡ t=="0")œ(a==""¡ t=="")“
print("Â§ñÈÉ®ÂõæÁâá‰∏ãËΩΩÂ§±Ë¥•ÔºåÂèØËÉΩÊòØÁΩëÁªúÂéüÂõ†ÈÄ†Êàê")
∆
Ã e=Cmd3DCode_Screenshot_ExternalPictures[o]
  Œ e “
print("Êú™ËÉΩÊâæÂà∞ID‰∏∫",o,"ÁöÑÊà™Âõæ")
—
∆
e.downloaded=”
e.width=tonumber(a)
e.height=tonumber(t)
Ã t="|Hplayer:"..e.from.author.."|h["..i(e.from.author).."]|h: ÂèëÊù•‰∫ÜÂõæÁâá "
t=t.."[ "..n(e,80,60).." ]"
» o=1,10 √
  _G["ChatFrame"..o.."Tab"]:IsVisible()“
Ã a,s,i,n
  e.from.msgtype=="CHANNEL"“
a=r(e.from.channel,GetChatWindowChannels(o))
  a “
Ã a=d(e.from.channel,GetChannelList())
s,i,n=GetMessageTypeColor("CHANNEL"..a)
t="["..e.from.channelString.."] "..t
∆
ƒ
a=r(e.from.msgtype,GetChatWindowMessages(o))
s,i,n=GetMessageTypeColor(e.from.msgtype)
∆
  a “
_G["ChatFrame"..o]:AddMessage(t,s,i,n,e.from.guid)
∆
∆
∆
∆
Ã r=0
Ã … e(t,s,a,e,f,l,m,p,y,w,i,c,o,d,...)
a=h(a,…(t)
  s=="CHAT_MSG_WHISPER_INFORM"œ e==GetUnitName("player",«).."-"..GetRealmName()“
Ã e=Cmd3DCode_Screenshot_CapturePictures_FromPicId(t)
Ã e=n(e,80,60)
—"[ "..e.." ]"
ƒ
  o>r “
r=o
Ã a={
author=e,
msgtype=s:sub(10),
channel=i,
channelString=l,
guid=d,
}
Ã a=u(t,i,a)
  time()-cmd3dcode_lastPingTime()>45 “
print("Êî∂Âà∞Êù•Ëá™"..e.."ÁöÑÊà™Âõæ: w.163.com/"..t.." ,ËØ∑ÂêØÂä®ÊúâÁà±ÂÆ¢Êà∑Á´ØÊòæÁ§∫Ê≠§Âõæ")
∆
ThreeDimensionsCode_Send("loadpic",a.texture..","..t)
∆
—""
∆
∆)
—#a<1,a,e,f,l,m,p,y,w,i,c,o,d,...
∆
ChatFrame_AddMessageEventFilter("CHAT_MSG_CHANNEL",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_SAY",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_YELL",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER_INFORM",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_BN_WHISPER",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_BN_WHISPER_INFORM",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID_LEADER",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY_LEADER",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_INSTANCE_CHAT",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_INSTANCE_CHAT_LEADER",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_GUILD",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_BATTLEGROUND",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_AFK",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_DND",e)
ChatFrame_AddMessageEventFilter("CHAT_MSG_OFFICER",e)
Ã t=250
Ã … o(a,e)
  Œ a:IsShown()“
e.cachedText=Õ
—
∆
t=math.max(a:GetWidth(),t)
Ã a=e:GetText()œ""
  a==e.cachedText “ — ∆
Ã a=h(a,…(e)
Ã e=Cmd3DCode_Screenshot_ExternalPictures_FromPicId(e)
  Œ e “ —""∆
  e.width<=0 “ —""∆
— n(e,100,75)
∆)
 #a>0 “
e:SetText(a)
e.cachedText=a
e:SetWidth(math.min(e:GetStringWidth(),t-14))
∆
∆
Ã … i()
» e=1,WorldFrame:GetNumChildren()√
Ã e=select(e,WorldFrame:GetChildren())
Ã t=e:GetBackdrop()
  t ¡ t.bgFile=="Interface\\Tooltips\\ChatBubble-Background"“
» t=1,e:GetNumRegions()√
Ã t=select(t,e:GetRegions())
  t:GetObjectType()=="FontString"“
o(e,t)
∆
∆
∆
∆
∆
Ã t=.3
Ã e=t
a:SetScript("OnUpdate",…(o,a)
e=e-a
  e<0 “
e=t
i()
∆
∆)
Ã o="%[Êà™Âõæ [%d:%(Ê∂ÇÈ∏¶%)]+ (%d+)%]"
Ã i="%[Ë°®ÊÉÖ ([0-9a-zA-Z]+)%]"
hooksecurefunc("AutoCompleteEditBox_OnEnterPressed",…()
Ã e=ChatEdit_ChooseBoxForSend()
  Œ e:IsVisible()“
—
∆
Ã e=e:GetText()
Ã t,a=1,picidx
–
t,a,picidx=string.find(e,o)
picidx=tonumber(picidx)
Ã o=Cmd3DCode_Screenshot_CapturePictures[picidx]
  picidx ¡ o ¡ o.picid “
e=e:sub(1,t-1)
.."[ÂèëÊù•‰∫ÜÊ∏∏ÊàèÊà™ÂõæÔºåÂú®ÊµèËßàÂô®‰∏≠ËæìÂÖ•ÁΩëÊòìÂÆòÊñπÁΩëÂùÄÊü•ÁúãÔºöhttp://w.163.com/"..o.picid.." ]"
..e:sub(a+1)
∆
‘ Œ t
–
t,a,picid=string.find(e,i)
  picid “
e=e:sub(1,t-1)
.."[ÂèëÊù•‰∫ÜË°®ÊÉÖÂõæÁâáÔºåÂú®ÊµèËßàÂô®‰∏≠ËæìÂÖ•ÁΩëÊòìÂÆòÊñπÁΩëÂùÄÊü•ÁúãÔºöhttp://w.163.com/"..picid.." ]"
..e:sub(a+1)
∆
‘ Œ t
ChatEdit_ChooseBoxForSend():SetText(e)
∆)
hooksecurefunc("AutoCompleteEditBox_OnEscapePressed",…()
» e=1,10 √
  _G["ChatFrame"..e.."Tab"]:IsVisible()“
_G["ChatFrame"..e.."EditBox"].frmPicUploading:Hide()
∆
∆
∆)
Ã e=CreateFrame("FRAME","Cmd3DCode_Screenshot_PicViewer",UIParent)
e:SetFrameStrata("TOOLTIP")
e:SetFrameLevel(120)
e:SetAllPoints(UIParent)
e:Hide()
e.bg=e:CreateTexture()
e.bg:SetTexture(.1,.1,.1,.7)
e.bg:SetAllPoints(e)
e:EnableKeyboard(”);
e:SetPropagateKeyboardInput(”);
e:SetScript("OnKeyDown",…(e,t,...)
  t=="ESCAPE"“
e:Hide()
e:SetPropagateKeyboardInput(«)
— «
∆
e:SetPropagateKeyboardInput(”);
∆)
e:SetScript("OnMouseDown",…(e)
e:Hide()
∆)
Ã t=CreateFrame("FRAME","Cmd3DCode_Screenshot_PicViewerPhoto",e)
t:SetPoint("CENTER")
t:SetWidth(403)
t:SetHeight(300)
t.texture=t:CreateTexture(Õ,"BACKGROUND")
t.texture:SetAllPoints(t)
Ã a={
viewpic=…(o,a,a,a,a,a)
Ã a=Cmd3DCode_Screenshot_ExternalPictures[o]
  Œ a “
print("picid",o,"Êó†Êïà")
—
∆
t.texture:SetTexture(a.texture)
t:SetWidth(a.width)
t:SetHeight(a.height)
e:Show()
∆
}
Ã s=SetItemRef
… SetItemRef(e,o,n,i)
Ã t,h=strmatch(e,"^(.+):(.+)$")
  Œ a[t]“
s(e,o,n,i)
—
∆
a[t](h,e,o,n,i)
∆
SLASH_3DCODECMDSCREENSHOT1="/ss"
SlashCmdList["3DCODECMDSCREENSHOT"]=…()Cmd3DCode_Screenshot_Start()∆]===], '@../!!!163UI.3dcodecmd!!!/screenshot.lua'))()